<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Cinder App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --tg-bg: var(--tg-theme-bg-color, #ffffff);
            --tg-text: var(--tg-theme-text-color, #000000);
            --tg-hint: var(--tg-theme-hint-color, #999999);
            --tg-button: var(--tg-theme-button-color, #007aff);
            --tg-button-text: var(--tg-theme-button-text-color, #ffffff);
            --tg-secondary-bg: var(--tg-theme-secondary-bg-color, #f0f0f0);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--tg-bg);
            color: var(--tg-text);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .main-content {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px 20px 80px 20px; /* Add padding to bottom to not be hidden by tab bar */
        }

        .page {
            display: none;
            animation: fadeInUp 0.5s ease-out forwards;
        }
        
        .page.active {
            display: block;
        }

        h2 {
            font-size: 28px;
            font-weight: 700;
            margin-top: 0;
            margin-bottom: 25px;
        }
        
        .tab-bar {
            display: flex;
            justify-content: space-around;
            background-color: var(--tg-secondary-bg);
            border-top: 1px solid var(--tg-hint-color, #e0e0e0);
            position: fixed;
            bottom: 0;
            width: 100%;
            box-sizing: border-box;
            padding-bottom: env(safe-area-inset-bottom, 0); /* Support for iPhone notches */
        }

        .tab-item {
            flex-grow: 1;
            text-align: center;
            padding: 12px 0;
            cursor: pointer;
            color: var(--tg-hint);
            transition: color 0.2s ease;
        }

        .tab-item svg {
            width: 28px;
            height: 28px;
            fill: currentColor;
        }

        .tab-item.active {
            color: var(--tg-button);
        }

        /* --- Submission Page Styles --- */
        .type-selector { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .type-button { padding: 15px; border-radius: 12px; background-color: var(--tg-secondary-bg); border: 2px solid transparent; text-align: center; font-weight: 600; cursor: pointer; transition: all 0.2s ease; }
        .type-button:active { transform: scale(0.97); }
        .type-button.active { border-color: var(--tg-button); background-color: transparent; }
        .sticker-selector { display: flex; align-items: center; justify-content: center; background-color: var(--tg-secondary-bg); border-radius: 12px; height: 140px; margin-bottom: 20px; cursor: pointer; text-align: center; color: var(--tg-hint); font-weight: 500; font-size: 16px; }
        .sticker-selector img { max-width: 120px; max-height: 120px; }
        textarea { width: 100%; height: 150px; padding: 12px; border-radius: 12px; border: 1px solid var(--tg-secondary-bg); background-color: var(--tg-secondary-bg); color: var(--tg-text); font-size: 16px; resize: none; box-sizing: border-box; margin-bottom: 15px; }
        textarea:focus { background-color: transparent; border-color: var(--tg-button); outline: none; }
        .options { display: flex; align-items: center; cursor: pointer; font-size: 15px; }
        .options input { margin-right: 12px; width: 18px; height: 18px; accent-color: var(--tg-button); }
        .action-button { width: 100%; padding: 15px; border-radius: 12px; background-color: var(--tg-secondary-bg); border: none; text-align: center; font-weight: 600; cursor: pointer; margin-top: 15px; color: var(--tg-text); font-size: 16px; }
        .action-button:active { transform: scale(0.98); }
    </style>
</head>
<body>

    <div class="main-content">
        <div id="page-submit" class="page">
            <h2>New Submission</h2>
            <div class="type-selector">
                <div class="type-button" id="type-ordinary">Ordinary üå™</div>
                <div class="type-button" id="type-sinners">Sinners ‚õì</div>
            </div>
            <div class="sticker-selector" id="sticker-selector">
                <span id="sticker-placeholder">Select Sticker</span>
                <img id="sticker-preview" src="" alt="Sticker Preview" style="display: none;">
            </div>
            <textarea id="news-text" placeholder="Write your news text here..."></textarea>
            <label class="options">
                <input type="checkbox" id="anon-reply-checkbox">
                Enable Anonymous Replies
            </label>
            <button id="load-presets-btn" class="action-button">Load Saved News üìù</button>
        </div>

        <div id="page-shop" class="page">
            <h2>üõçÔ∏è Shop</h2>
            <p style="text-align: center; color: var(--tg-hint);">The graphical shop for borders and pins will be built here.</p>
        </div>

        <div id="page-profile" class="page">
            <h2>üë§ My Profile</h2>
            <p style="text-align: center; color: var(--tg-hint);">Your stats, achievements, and rank dashboard will appear here.</p>
        </div>
    </div>

    <nav class="tab-bar">
        <div class="tab-item" data-page="page-submit">
            <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"></path></svg>
        </div>
        <div class="tab-item" data-page="page-shop">
            <svg viewBox="0 0 24 24"><path d="M18 6h-2c0-2.21-1.79-4-4-4S8 3.79 8 6H6c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-6-2c1.1 0 2 .9 2 2h-4c0-1.1.9-2 2-2zm6 16H6V8h2v2c0 .55.45 1 1 1s1-.45 1-1V8h4v2c0 .55.45 1 1 1s1-.45 1-1V8h2v12z"></path></svg>
        </div>
        <div class="tab-item" data-page="page-profile">
            <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"></path></svg>
        </div>
    </nav>


<script>
    // --- All JavaScript from the previous version goes here, unchanged. ---
    const tg = window.Telegram.WebApp;

    // --- Page Navigation Logic ---
    const tabItems = document.querySelectorAll('.tab-item');
    const pages = document.querySelectorAll('.page');

    function showPage(pageId) {
        pages.forEach(page => {
            page.classList.remove('active');
        });
        document.getElementById(pageId).classList.add('active');

        tabItems.forEach(tab => {
            if (tab.dataset.page === pageId) {
                tab.classList.add('active');
            } else {
                tab.classList.remove('active');
            }
        });

        if (pageId === 'page-submit') {
            checkFormCompletion();
        } else {
            tg.MainButton.hide();
        }
    }

    tabItems.forEach(tab => {
        tab.addEventListener('click', () => {
            showPage(tab.dataset.page);
        });
    });


    // --- Submission Page Logic (from before) ---
    const btnOrdinary = document.getElementById('type-ordinary');
    const btnSinners = document.getElementById('type-sinners');
    const stickerSelector = document.getElementById('sticker-selector');
    const stickerPlaceholder = document.getElementById('sticker-placeholder');
    const stickerPreview = document.getElementById('sticker-preview');
    const newsText = document.getElementById('news-text');
    const anonReplyCheckbox = document.getElementById('anon-reply-checkbox');
    const loadPresetsBtn = document.getElementById('load-presets-btn'); // For future use

    let submissionData = { newsType: null, stickerFileId: null, text: '', enableAnonReply: false };

    tg.MainButton.setText('Submit News');

    function checkFormCompletion() {
        if (submissionData.newsType && submissionData.stickerFileId && submissionData.text.trim() !== '') {
            tg.MainButton.show();
        } else {
            tg.MainButton.hide();
        }
    }

    btnOrdinary.addEventListener('click', () => {
        submissionData.newsType = 'Ordinary üå™';
        btnOrdinary.classList.add('active'); btnSinners.classList.remove('active');
        checkFormCompletion();
    });
    btnSinners.addEventListener('click', () => {
        submissionData.newsType = 'Sinners ‚õì';
        btnSinners.classList.add('active'); btnOrdinary.classList.remove('active');
        checkFormCompletion();
    });
    stickerSelector.addEventListener('click', () => {
        tg.showStickerPicker({text: 'Select a sticker for your news'}, (sticker) => {
            submissionData.stickerFileId = sticker.file_id;
            stickerPreview.src = sticker.thumbnail_url;
            stickerPreview.style.display = 'block'; stickerPlaceholder.style.display = 'none';
            checkFormCompletion();
        });
    });
    newsText.addEventListener('input', (e) => { submissionData.text = e.target.value; checkFormCompletion(); });
    anonReplyCheckbox.addEventListener('change', (e) => { submissionData.enableAnonReply = e.target.checked; });
    loadPresetsBtn.addEventListener('click', () => {
        tg.showAlert('This feature will be connected to the backend soon!');
    });

    tg.onEvent('mainButtonClicked', () => {
        if (document.getElementById('page-submit').classList.contains('active')) {
            const finalData = {
                news_type: submissionData.newsType,
                sticker_file_id: submissionData.stickerFileId,
                text: submissionData.text,
                enable_anon_reply: submissionData.enableAnonReply
            };
            tg.sendData(JSON.stringify(finalData));
        }
    });

    // --- Initialization ---
    tg.ready();
    tg.expand();
    showPage('page-submit');

</script>
</body>
</html>
