<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Test</title>
    <!-- Load the official Telegram script -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            text-align: center;
            padding: 20px;
        }
        #message-box {
            padding: 20px;
            background-color: var(--tg-theme-secondary-bg-color, #f0f0f0);
            border-radius: 12px;
            word-wrap: break-word; /* Prevents long strings from overflowing */
        }
    </style>
</head>
<body>

    <h1>Telegram Mini App Test</h1>
    <p>This page checks if the bot is sending data correctly.</p>

    <div id="message-box">
        <p>Waiting for data...</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const messageBox = document.getElementById('message-box');
            
            // First, check if we are inside Telegram at all
            if (!window.Telegram || !window.Telegram.WebApp) {
                messageBox.innerHTML = '<h2>Error</h2><p>This is a Telegram Mini App and must be opened from inside the Telegram client.</p>';
                return;
            }

            const tg = window.Telegram.WebApp;

            tg.ready(() => {
                tg.expand();
                
                // Check if the bot passed any data in the URL
                if (tg.initDataUnsafe && tg.initDataUnsafe.start_param) {
                    try {
                        const encodedData = tg.initDataUnsafe.start_param;
                        // Decode the data from Base64
                        const decodedData = atob(encodedData);
                        // Parse the JSON string
                        const jsonData = JSON.parse(decodedData);

                        // Display the received data
                        messageBox.innerHTML = `
                            <h2>Success!</h2>
                            <p>The bot sent the following data:</p>
                            <pre><code>${JSON.stringify(jsonData, null, 2)}</code></pre>
                        `;
                    } catch (e) {
                        messageBox.innerHTML = `<h2>JavaScript Error</h2><p>Could not decode or parse the data from the bot. Error: ${e.message}</p>`;
                    }
                } else {
                    // This message shows if the bot didn't attach any data
                    messageBox.innerHTML = '<h2>No Data Received</h2><p>The app opened, but the bot did not send any data in the launch URL.</p>';
                }
            });
        });
    </script>

</body>
</html>
