<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Cinder News</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --tg-bg: var(--tg-theme-bg-color, #ffffff);
            --tg-text: var(--tg-theme-text-color, #000000);
            --tg-hint: var(--tg-theme-hint-color, #999999);
            --tg-button: var(--tg-theme-button-color, #007aff);
            --tg-button-text: var(--tg-theme-button-text-color, #ffffff);
            --tg-secondary-bg: var(--tg-theme-secondary-bg-color, #f0f0f0);
            --tg-header-bg: var(--tg-theme-header-bg-color, #efeff3);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--tg-bg);
            color: var(--tg-text);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        .main-content {
            flex-grow: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .page {
            display: none; /* All pages are hidden by default */
        }
        
        .page.active {
            display: block; /* The active page is shown */
        }

        h1 {
            font-size: 24px;
            margin-bottom: 20px;
        }

        /* --- Tab Bar Styles --- */
        .tab-bar {
            display: flex;
            justify-content: space-around;
            background-color: var(--tg-header-bg);
            border-top: 1px solid var(--tg-secondary-bg);
            padding: 5px 0;
            position: fixed;
            bottom: 0;
            width: 100%;
            box-sizing: border-box;
        }

        .tab-item {
            flex-grow: 1;
            text-align: center;
            padding: 10px 0;
            cursor: pointer;
            color: var(--tg-hint);
            font-weight: 500;
            transition: color 0.2s ease;
        }

        .tab-item.active {
            color: var(--tg-button);
        }

        /* --- Submission Page Styles (from before) --- */
        .type-selector { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .type-button { padding: 12px; border-radius: 8px; background-color: var(--tg-secondary-bg); border: 2px solid transparent; text-align: center; font-weight: 600; cursor: pointer; }
        .type-button.active { border-color: var(--tg-button); color: var(--tg-button); }
        .sticker-selector { display: flex; align-items: center; justify-content: center; background-color: var(--tg-secondary-bg); border-radius: 8px; min-height: 120px; margin-bottom: 15px; cursor: pointer; text-align: center; color: var(--tg-hint); }
        .sticker-selector img { max-width: 100px; max-height: 100px; }
        textarea { width: 100%; height: 150px; padding: 10px; border-radius: 8px; border: 1px solid var(--tg-hint); background-color: var(--tg-secondary-bg); color: var(--tg-text); font-size: 16px; resize: none; box-sizing: border-box; margin-bottom: 15px; }
        .options { display: flex; align-items: center; cursor: pointer; }
        .options input { margin-right: 10px; }

    </style>
</head>
<body>

    <div class="main-content">
        <div id="page-submit" class="page">
            <h1>New Submission</h1>
            <div class="type-selector">
                <div class="type-button" id="type-ordinary">Ordinary üå™</div>
                <div class="type-button" id="type-sinners">Sinners ‚õì</div>
            </div>
            <div class="sticker-selector" id="sticker-selector">
                <span id="sticker-placeholder">Click to Select Sticker</span>
                <img id="sticker-preview" src="" alt="Sticker Preview" style="display: none;">
            </div>
            <textarea id="news-text" placeholder="Write your news text here..."></textarea>
            <label class="options">
                <input type="checkbox" id="anon-reply-checkbox">
                Enable Anonymous Replies
            </label>
        </div>

        <div id="page-shop" class="page">
            <h1>üõçÔ∏è Shop</h1>
            <p>The graphical shop for borders and pins will be built here.</p>
        </div>

        <div id="page-profile" class="page">
            <h1>üë§ My Profile</h1>
            <p>Your stats, achievements, and rank dashboard will appear here.</p>
        </div>
    </div>

    <nav class="tab-bar">
        <div class="tab-item" data-page="page-submit">Submit</div>
        <div class="tab-item" data-page="page-shop">Shop</div>
        <div class="tab-item" data-page="page-profile">Profile</div>
    </nav>


<script>
    const tg = window.Telegram.WebApp;

    // --- Page Navigation Logic ---
    const tabItems = document.querySelectorAll('.tab-item');
    const pages = document.querySelectorAll('.page');

    function showPage(pageId) {
        pages.forEach(page => {
            page.style.display = 'none';
        });
        document.getElementById(pageId).style.display = 'block';

        tabItems.forEach(tab => {
            if (tab.dataset.page === pageId) {
                tab.classList.add('active');
            } else {
                tab.classList.remove('active');
            }
        });

        // Show the main submission button only on the submit page
        if (pageId === 'page-submit') {
            checkFormCompletion();
        } else {
            tg.MainButton.hide();
        }
    }

    tabItems.forEach(tab => {
        tab.addEventListener('click', () => {
            showPage(tab.dataset.page);
        });
    });


    // --- Submission Page Logic (from before) ---
    const btnOrdinary = document.getElementById('type-ordinary');
    const btnSinners = document.getElementById('type-sinners');
    const stickerSelector = document.getElementById('sticker-selector');
    const stickerPlaceholder = document.getElementById('sticker-placeholder');
    const stickerPreview = document.getElementById('sticker-preview');
    const newsText = document.getElementById('news-text');
    const anonReplyCheckbox = document.getElementById('anon-reply-checkbox');

    let submissionData = { newsType: null, stickerFileId: null, text: '', enableAnonReply: false };

    tg.MainButton.setText('Submit News');

    function checkFormCompletion() {
        if (submissionData.newsType && submissionData.stickerFileId && submissionData.text.trim() !== '') {
            tg.MainButton.show();
        } else {
            tg.MainButton.hide();
        }
    }

    btnOrdinary.addEventListener('click', () => {
        submissionData.newsType = 'Ordinary üå™';
        btnOrdinary.classList.add('active'); btnSinners.classList.remove('active');
        checkFormCompletion();
    });
    btnSinners.addEventListener('click', () => {
        submissionData.newsType = 'Sinners ‚õì';
        btnSinners.classList.add('active'); btnOrdinary.classList.remove('active');
        checkFormCompletion();
    });
    stickerSelector.addEventListener('click', () => {
        tg.showStickerPicker({text: 'Select a sticker for your news'}, (sticker) => {
            submissionData.stickerFileId = sticker.file_id;
            stickerPreview.src = sticker.thumbnail_url;
            stickerPreview.style.display = 'block'; stickerPlaceholder.style.display = 'none';
            checkFormCompletion();
        });
    });
    newsText.addEventListener('input', (e) => { submissionData.text = e.target.value; checkFormCompletion(); });
    anonReplyCheckbox.addEventListener('change', (e) => { submissionData.enableAnonReply = e.target.checked; });

    tg.onEvent('mainButtonClicked', () => {
        if (document.getElementById('page-submit').style.display === 'block') {
            const finalData = {
                news_type: submissionData.newsType,
                sticker_file_id: submissionData.stickerFileId,
                text: submissionData.text,
                enable_anon_reply: submissionData.enableAnonReply
            };
            tg.sendData(JSON.stringify(finalData));
        }
    });

    // --- Initialization ---
    tg.ready();
    tg.expand();
    showPage('page-submit'); // Show the submission page by default

</script>
</body>
</html>
